# Math Monster Battle — 產品更新路線圖

**目標**：上架 Apple App Store + Steam
**用戶年齡**：6–15 歲
**商業模式**：買斷制 $1–3 USD
**技術路線**：Web + PWA 為主體，Capacitor (iOS) / Electron (Steam) 打包

---

## 現狀分析

### 已完成的核心（截至 2026-02-22）

- 7 主角 × 4 招式 × 3 階段進化，完整 11 屬性相剋系統
- 14+ 種敵人（含進化形態）+ 4 Boss（暗王、九頭蛇、瘋龍、劍神）
- 數據驅動的關卡波次系統（單人 + 雙打模式）
- 數學題型覆蓋：四則運算、混合運算、未知數方程式、分數（比較/同分母/異分母/乘除）、小數（加減/分數轉換/乘/除）
- 自適應難度系統（per-operation sliding window，80% 升級門檻）
- 狀態效果（灼燒、凍結、麻痺、特殊防禦、靜電放電）
- 進化系統（3 階段）+ 招式升級
- 計時模式 + 本地排行榜（localStorage）
- 7 場景背景 + 10 種屬性攻擊特效 + 環境粒子 + 天氣效果
- 完整音效系統（12 首 BGM + 50+ Web Audio API 合成音效）
- 繁中 + 英文雙語 i18n（~800 翻譯鍵）
- PWA 離線支援、直向鎖定
- 本地 PvP 對戰 + Co-op 合作模式
- 怪獸圖鑑 + 成就系統（22 個成就）+ 收集系統
- 道具系統（藥水/糖果/護盾）+ 掉落表 + 保底機制
- 每日挑戰 + 無盡塔
- PIN 保護的家長數據分析儀表板
- 互動式遊戲教學頁面
- 設定頁面（BGM/SFX/效能模式/語言）
- Capacitor (iOS) + Electron (Steam) 打包基礎設施
- 194 個源碼檔、~39,400 行產品代碼、70 個測試檔（~10,600 行）

### 上架前的剩餘缺口

| 缺口 | 嚴重度 | 說明 |
|------|--------|------|
| 無存檔系統 | 🔴 高 | 關閉頁面即喪失當局進度，無法留住玩家 |
| 錯題回顧 | 🟡 中 | GameOver 有統計但無逐題複習功能 |
| 難度選擇 UI | 🟠 低中 | 基礎設施已有（starter 難度分級），但無獨立 UI |
| 隱私政策缺失 | 🔴 高 | Apple/Steam 上架強制需要 |
| 上架素材 | 🔴 高 | App icon、截圖、trailer 等尚未製作 |
| 自訂題庫 | 🟠 低 | 教育市場差異化功能，非上架必要 |

---

## 短期更新（1–2 個月）— 打磨核心體驗

### S1. 音效系統 ✅ 已完成

- ~~背景音樂：標題畫面、5 種場景各一首~~
- ~~戰鬥音效：答對、答錯、攻擊命中、敵人攻擊、進化、勝利、KO~~
- ~~設定頁加入音量滑桿（BGM / SE 分開）~~
- **實際成果**：12 首 BGM（menu/battle/volcano/coast/thunder/ironclad/graveyard/canyon + 4 Boss 專屬曲）+ 50+ 純 Web Audio API 合成音效（零外部依賴），附 synth fallback 機制

### S2. 存檔與進度保存 ❌ 未完成

- **未完成**：
  - 自動存檔：每場戰鬥勝利後寫入 localStorage（戰鬥中途狀態未被持久化）
  - 存檔內容：目前回合、HP、Lv、招式等級、連擊紀錄、正確率
  - 標題畫面顯示「繼續冒險」按鈕（有存檔時）
  - 新增「重新開始」確認對話框，防止誤觸
- **現狀**：已有跨局累積數據持久化（成就、圖鑑、收集、道具庫存、排行榜、session 分析記錄、家長 PIN），但**無戰鬥中途存檔功能**——關閉頁面即喪失當局進度

### S3. 新手教學（首次遊玩引導）✅ 已完成

- ~~基本流程教學~~
- ~~屬性相剋簡介~~
- ~~充能條 → 終極爆破說明~~
- **實際成果**：`HowToPlayScreen.tsx`（358 行），涵蓋 7 主角展示、戰鬥流程、模式說明（普通/計時/合作/對戰）、技能威力公式、道具掉落表、稀有度機制、保底系統說明

### S4. 設定頁面 ✅ 已完成

- ~~從標題畫面進入~~
- ~~項目：BGM 音量、SE 音量、語言~~
- **實際成果**：`SettingsScreen.tsx`（270 行），含 BGM 開關 + 音量滑桿（0–100%）、SFX 開關、效能模式（自動/省電/標準）、語言切換、儲存空間資訊

### S5. 難度選擇 🟡 部分完成

- **已完成**：每隻主角內建難度分級（1–5 星）與年級範圍（1–6 年級），選角即選難度
- **未完成**：~~簡單/普通/困難三檔全域難度選擇 UI~~
- **備註**：目前的設計以「選擇不同主角 = 選擇不同難度」取代全域難度，這可能是更好的設計——讓難度選擇與角色選擇融為一體，對兒童更直覺

### S6. 錯題回顧 ❌ 未完成

- **未完成**：
  - GameOver 畫面新增「錯題複習」按鈕
  - 記錄本局所有答錯的題目（display + answer）
  - 顯示正確答案 + 簡單解題步驟
- **現狀**：GameOverScreen 顯示正確/錯誤/正確率統計，但無逐題回顧

---

## 中期更新（3–6 個月）— 擴充內容與重玩性

### M1. 怪獸圖鑑系統 ✅ 已完成

- ~~新 Screen：「圖鑑」（從標題畫面進入）~~
- ~~紀錄所有遭遇過的怪獸（普通形態 + 進化形態）~~
- ~~每隻怪獸頁面：插圖、屬性、HP/ATK、弱點提示、已擊敗次數~~
- ~~圖鑑完成度百分比~~
- **實際成果**：`EncyclopediaScreen.tsx`（605 行），含 14+ 敵人 + 主角形態、互動式詳情 modal、屬性/稀有度/弱點顯示、精靈尺寸補償

### M2. 成就系統 ✅ 已完成（超額）

- ~~15–20 個成就~~
- ~~成就徽章顯示在玩家個人頁~~
- ~~解鎖成就時有彈窗動畫 + 音效~~
- **實際成果**：22 個成就，涵蓋戰鬥里程碑（first_win、streak_5/10、perfect、one_hit）、Boss 挑戰、生存、7 種屬性通關、圖鑑、招式精通、計時模式、特殊防禦

### M3. 多主角擴充 ✅ 已完成（大幅超額）

- ~~新主角：小雷獸（電系）~~
- **實際成果**：7 隻主角（遠超原計劃的 4 隻）
  1. 🌿 小草獸（草系）→ 加減法（1–2 年級）
  2. 🔥 小火獸（火系）→ 乘法（2–3 年級）
  3. 💧 小水獸（水系）→ 除法（3–4 年級）
  4. ⚡ 小雷獸（電系）→ 混合運算（3–4 年級）
  5. 🐺 小鋼狼（鋼系）→ 分數運算（4–5 年級）
  6. 🦁 小獅獸（光系）→ 未知數方程式（5–6 年級）
  7. 🐯 小冰虎（冰系）→ 小數運算（5–6 年級）
- 每隻 3 階段進化、4 招式（含終極爆破）、獨立被動技 + 特殊防禦

### M4. 關卡模式（章節制）✅ 已完成

- ~~數據驅動的關卡波次系統~~
- **實際成果**：`stageConfigs.ts` 實作數據驅動的波次配置，支援單人 + 雙打（1v2）模式、敵人梯度強化、隨機置換系統、場景主題綁定。含 4 隻 Boss 作為章節門檻

### M5. 每日挑戰 ✅ 已完成（超額）

- ~~每天一題特殊關卡（固定 seed，全玩家同題）~~
- ~~完成後獲得每日獎勵~~
- ~~7 天連續完成 → 特殊成就~~
- **實際成果**：`DailyChallengeScreen.tsx` + `challengeRuntime.ts`，含日期 seed、修飾器系統（buff/debuff）、連續挑戰追蹤。額外實作**無盡塔**系統（逐層遞增難度、檢查點、最佳樓層紀錄）

### M6. 國際化（i18n）✅ 已完成

- ~~引入 i18next + react-i18next~~
- ~~語言切換在設定頁~~
- **實際成果**：繁體中文（zh-TW）+ 英文（en-US），~800 翻譯鍵，涵蓋怪獸名/招式名/UI/教學/成就/儀表板/每日挑戰。設定頁可切換語言
- **待擴充**：簡中、日文（視上架市場需求）

---

## 長期更新（6–12 個月）— 上架準備 + 社交功能

### L1. 上架包裝 🟡 基礎設施就緒

#### iOS (App Store)
- [x] Capacitor 打包配置（`capacitor.config.ts`）
- [ ] App icon（1024×1024 + 各尺寸）
- [ ] Launch screen / splash screen
- [ ] Safe area 適配（劉海、圓角）
- [ ] 隱私政策頁面（必須有 URL）
- [ ] App Store 截圖（6.7" / 6.1" / iPad）
- [ ] 年齡分級填報（4+ 教育類）
- [ ] TestFlight 測試
- [ ] 提交審查

#### Steam
- [x] Electron 打包配置（`electron/` 目錄）
- [ ] Steamworks 開發者帳號（$100 一次性）
- [ ] Steamworks SDK 整合（成就、排行榜）
- [ ] 商店頁面素材（header banner、capsule images、截圖、trailer）
- [ ] 鍵盤操作支援（方向鍵選招、數字鍵答題）
- [ ] 全螢幕 / 視窗模式切換
- [ ] 手把支援（加分項）

### L2. 排行榜 ✅ 本地版完成

- **已完成**：本地 Top 10 排行榜（`leaderboard.ts`），含分數公式（擊敗數 × 100 + 等級 × 30 + 正確率加成 + 連擊獎勵 + 計時模式 ×1.5 倍率）、玩家暱稱、日期、主角紀錄、獎牌顯示
- **未完成**：~~線上後端（Firebase/Supabase）、全球排行、防作弊 hash~~
- **備註**：本地排行對買斷制遊戲已足夠，線上排行可作為後續差異化功能

### L3. 對戰模式（PvP）✅ 已完成

- ~~本地雙人對戰（同一裝置）~~
- ~~雙方各選一主角，同時出題~~
- ~~先答對的玩家發動攻擊~~
- **實際成果**：完整 PvP 系統（`pvpFlow.ts` 520 行 + `pvpStrikeResolver.ts` 533 行 + `pvpAnimationOrchestrator.ts` + `PvpResultScreen.tsx`），含回合制、狀態效果、combo/charge 追蹤、專用平衡配置（`pvpBalance.ts`）、Boss 角色解鎖（PvE 擊敗後可在 PvP 使用）

### L4. 自訂題庫 ❌ 未開始

- 家長/老師可以建立自訂題庫
- 支援手動輸入題目 + 答案
- 套用到「自訂挑戰」模式
- 題庫可匯出/匯入（JSON 格式）
- **備註**：目前使用程式化題目生成，覆蓋 12+ 種題型與自適應難度，已能滿足大部分教學需求

### L5. 視覺升級 🟡 部分完成

- **已完成**：
  - 場景天氣效果（`BattleWeatherLayer.tsx`：雨/雪/霧/沙塵/風暴，綁定場景主題）
  - 10 種屬性攻擊特效（火/水/草/電/冰/暗/光/鋼/毒/岩）
  - 怪獸 idle 浮動 + 呼吸動畫
  - 環境粒子特效（`AmbientParticles.tsx`）
  - 低效能模式自動降級
  - Boss 專屬脈動動畫 + 登場演出
- **未完成**：~~眨眼/尾巴擺動細節動畫、進化動畫加長~~

### L6. 數據分析儀表板（家長模式）✅ 已完成

- ~~從設定頁進入（需輸入簡單密碼防兒童誤入）~~
- ~~各運算的正確率趨勢~~
- ~~最常答錯的題型~~
- ~~進步曲線~~
- **實際成果**：`DashboardScreen.tsx`（647 行）+ `dashboardInsights.ts`，含 4 位 PIN 保護、per-operation 正確率追蹤（加/減/乘/除/混合/未知數/分數/小數）、session 歷史詳情、每週/歷史分析、弱點識別 + 優先練習建議、per-starter 表現分析、反應時間趨勢、批次清除功能

---

## 路線圖外的額外功能

以下功能在原始路線圖中未規劃，但已實作：

### 🤝 合作模式（Co-op）
- 雙主角團隊管理，主/副角色自動輪換
- 支援回合系統（副角色協助攻擊）
- 隊伍全滅處理、角色交換機制
- 實作：`coopFlow.ts`（255 行）+ `coopTurnRotationFlow.ts` + `coopActionController.ts`

### 📦 道具與收集系統
- 收集系統：14+ 種掉落物（普通/稀有/史詩/傳說），里程碑進度
- 道具系統：藥水（回血 cap:5）、糖果（小回血 cap:12）、護盾（擋一擊 cap:3）
- 掉落表：敵人專屬掉率 + 保底機制（7 次未出傳說保底）
- 實作：`CollectionScreen.tsx` + `collectionStore.ts` + `itemCatalog.ts` + `inventoryStore.ts` + `dropTables.ts`

### 🏔️ 無盡塔
- 逐層遞增難度的挑戰模式
- 檢查點系統 + 最佳樓層紀錄
- 與每日挑戰獨立的持續挑戰內容

### 🐉 4 Boss 角色
- 暗王（boss）、九頭蛇（boss_hydra）、瘋龍（boss_crazy_dragon）、劍神（boss_sword_god）
- PvE 擊敗後可在 PvP 模式使用
- 各有專屬 BGM + 登場演出 + 勝利特效

### 🧬 精靈佈局系統
- `spriteProfiles.ts`：精靈幾何補償（高度/寬度比率）
- `battleLayout.ts`（288 行）：數據驅動的戰鬥佈局計算，支援單人/合作/PvP/雙打模式
- `useBattleArenaScale.ts`：響應式視口縮放（base 430px，0.9–1.16 倍）
- 敵人個性系統（`enemyPersonalities.ts`）

---

## 完成度總覽

```
短期（S1–S6）:  4/6 完成（S2 未完成、S5 部分、S6 未完成）
中期（M1–M6）:  6/6 完成（M3 大幅超額）
長期（L1–L6）:  3/6 完成、2/6 部分完成、1/6 未開始
路線圖外功能：  5 項額外實作

整體完成度：    ~80%（含超額部分實質 >90%）
```

### 上架前剩餘工作

```
必做（上架門檻）
  S2 存檔系統        ← 關頁面就喪失進度，玩家會流失
  S6 錯題回顧        ← 教育類 App 審查加分項
  L1 上架素材        ← icon、截圖、隱私政策、商店描述
  隱私政策           ← Apple/Steam 強制

建議（提升品質）
  S5 難度 UI         ← 可選：目前「選角即選難度」設計可能已足夠
  L5 動畫細節        ← 進化動畫加長、idle 細節

後續差異化
  L2 線上排行榜      ← 社交競爭（需後端）
  L4 自訂題庫        ← 教育市場差異化
```

---

## 技術架構現況

```
現在:   React 19 + Vite 7 + TypeScript 5.9 + PWA (vite-plugin-pwa)
        │
        ├─ 音效: Web Audio API（合成 SFX）+ MP3（BGM）
        ├─ i18n: react-i18next（繁中 + 英文）
        ├─ 持久化: localStorage（存檔/設定/排行/成就/收集/庫存/儀表板）
        ├─ 測試: Vitest + 70 test files（~10,600 行）
        │
        ├─ 打包就緒:
        │    ├─ Capacitor 8 → iOS App Store
        │    └─ Electron 40 → Steam (Win/Mac)
        │
        └─ 代碼規模:
             ├─ 194 源碼檔、~39,400 行產品代碼
             ├─ 戰鬥系統: ~50 模組、分層架構（reducer → resolver → flow → orchestrator）
             └─ 數據驅動: 平衡配置 / 關卡配置 / 精靈配置 / 掉落表 全外部化
```

依賴項目保持最少。核心邏輯永遠是純前端 React，平台包裝層只是外殼。

---

## App Store / Steam 上架 Checklist

### Apple App Store
- [ ] Apple Developer 帳號 ($99/年)
- [ ] App icon 全尺寸
- [ ] Launch screen
- [ ] 隱私政策 URL
- [ ] 年齡分級填報（4+ 教育類）
- [ ] 截圖 (iPhone 6.7" + 6.1" + iPad)
- [ ] App 描述（繁中 + 英文）
- [x] Capacitor 打包配置
- [ ] Xcode 簽名
- [ ] TestFlight 測試
- [ ] 提交審查

### Steam
- [ ] Steamworks 開發者帳號 ($100)
- [ ] 商店頁面素材（header, capsule, screenshots）
- [ ] 遊戲 trailer 影片（30–60 秒）
- [x] Electron 打包配置
- [ ] Steamworks SDK 整合
- [ ] 鍵盤 / 手把操作
- [ ] 商店描述 + 標籤
- [ ] 提交審查

---

*最後更新：2026-02-22*
